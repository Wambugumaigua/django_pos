{% extends 'pos/base.html' %}
{% load static %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <h4 class="fw-bold">Units</h4>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#unitModal" onclick="openAddUnitModal()">+ Add Unit</button>
</div>

<table class="table table-striped mt-3" id="unitsTable">
    <thead>
        <tr>
            <th>Unit</th>
            <th>Short Name</th>
            <th>No of Products</th>
            <th>Created Date</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Hardcoded Units -->
        <tr>
            <td>Kilograms</td>
            <td>kg</td>
            <td>25</td>
            <td>24 Dec 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Liters</td>
            <td>L</td>
            <td>18</td>
            <td>10 Dec 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Dozen</td>
            <td>dz</td>
            <td>30</td>
            <td>27 Nov 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Pieces</td>
            <td>pcs</td>
            <td>42</td>
            <td>18 Nov 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Boxes</td>
            <td>bx</td>
            <td>60</td>
            <td>06 Nov 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Tons</td>
            <td>t</td>
            <td>10</td>
            <td>25 Oct 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Grams</td>
            <td>g</td>
            <td>70</td>
            <td>03 Oct 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Meters</td>
            <td>m</td>
            <td>80</td>
            <td>20 Sep 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
        <tr>
            <td>Centimeters</td>
            <td>cm</td>
            <td>120</td>
            <td>10 Sep 2024</td>
            <td><span class="badge bg-success">Active</span></td>
            <td>
                <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
                <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
            </td>
        </tr>
    </tbody>
</table>

<!-- Add/Edit Unit Modal -->
<div class="modal fade" id="unitModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="unitModalTitle">Add Unit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="unitForm" onsubmit="saveUnit(event)">
                    <input type="hidden" id="editUnitIndex">
                    <input type="text" class="form-control mb-2" id="unitName" placeholder="Unit Name" required>
                    <input type="text" class="form-control mb-2" id="shortName" placeholder="Short Name" required>
                    <div class="text-end">
                        <button type="submit" class="btn btn-success">Save</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Unit Modal -->
<div class="modal fade" id="deleteUnitModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Delete Unit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Do you want to delete this unit?</p>
                <div class="text-end">
                    <button class="btn btn-danger" id="confirmDeleteUnit">Delete</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let unitToDelete = null;

function openAddUnitModal() {
    document.getElementById('unitModalTitle').innerText = "Add Unit";
    document.getElementById('editUnitIndex').value = "";
    document.getElementById('unitForm').reset();
}

function openEditUnitModal(el) {
    const row = el.closest('tr');
    const cells = row.querySelectorAll('td');
    document.getElementById('unitModalTitle').innerText = "Edit Unit";
    document.getElementById('editUnitIndex').value = row.rowIndex;
    document.getElementById('unitName').value = cells[0].innerText;
    document.getElementById('shortName').value = cells[1].innerText;
}

function saveUnit(e) {
    e.preventDefault();
    const table = document.getElementById('unitsTable').getElementsByTagName('tbody')[0];
    const editIndex = document.getElementById('editUnitIndex').value;
    const row = editIndex ? table.rows[editIndex-1] : table.insertRow();

    const now = new Date();
    const dateString = now.toLocaleDateString('en-GB', {day:'2-digit', month:'short', year:'numeric'});

    row.innerHTML = `
        <td>${document.getElementById('unitName').value}</td>
        <td>${document.getElementById('shortName').value}</td>
        <td>0</td>
        <td>${dateString}</td>
        <td><span class="badge bg-success">Active</span></td>
        <td>
            <i class="fa fa-edit text-primary" onclick="openEditUnitModal(this)" data-bs-toggle="modal" data-bs-target="#unitModal"></i>
            <i class="fa fa-trash text-danger ms-2" onclick="openDeleteUnitModal(this)"></i>
        </td>
    `;
    bootstrap.Modal.getInstance(document.getElementById('unitModal')).hide();
}

function openDeleteUnitModal(el) {
    unitToDelete = el.closest('tr');
    const modal = new bootstrap.Modal(document.getElementById('deleteUnitModal'));
    modal.show();
}

document.getElementById('confirmDeleteUnit').addEventListener('click', function() {
    if (unitToDelete) unitToDelete.remove();
    bootstrap.Modal.getInstance(document.getElementById('deleteUnitModal')).hide();
});
</script>

{% endblock %}
